!function(e){function t(t,n,a,i,o){function d(){var t=n.viewedMonth.month();a.find(l).each(function(){var n=e(this),a=i.data[n.index()];if(!a)return!0;var d=a.weekDateTime;n.data("date",d);var s=o||d.getMonth()===t;n.toggleClass("clickable",s),n.toggleClass("non-clickable",!s)})}t.bind("navigate",d),a.bind("dataBound",d),d(),a.delegate(l,"click",function(){var a=e(this),i=a.data("date");a.hasClass("clickable")&&ots.core.oneTime.selectDayInCalendar(t,n,i,o)})}function n(e,t,n){function a(){var n=ots.core.oneTime.getDayInDisplayedCalendar(e,t,ots.core.dates.getDateNow());e.find(".t-content tbody tr td.today").not(n?n.$td:[]).removeClass("today"),n&&n.$td.addClass("today")}e.bind("navigate change",a),n.bind("dataBound",a),a()}function a(t){function n(){return t.find(".t-content.t-state-active .t-grid-content table tbody tr")}function a(){var t=o.val().trim();n().each(function(){var n=e(this);n.toggle(!t||ots.core.containsSubstring(n.text(),t))})}var i=e('<li class="favourites-filter"></li>').appendTo(t.find("ul.t-tabstrip-items")),o=e('<input type="search" placeholder="Type here to filter" />').appendTo(i).bind("keyup mouseout mousedown search",a);ots.core.oneTime.onFavTabSelected(t,function(t){var n=e(t.item).text();i.toggle(ots.core.containsSubstring(n,"personal")||ots.core.containsSubstring(n,"team")),o.val(""),a()})}function i(e,t,n,a){function i(){function n(e){e.weekOfTimesheets.isIncomplete?_.chain(e.$dayTds).zip(e.weekOfTimesheets.days).map(function(e){return{date:e[1].date,isIncomplete:e[1].isIncomplete,$td:e[0]}}).filter(function(e){return a||e.date<s}).each(function(e){e.$td.toggleClass("incomplete",e.isIncomplete)}).value():_.each(e.$dayTds,function(e){e.removeClass("incomplete")})}var i=ots.core.oneTime.getWeeksInDisplayedCalendar(e,t),o=_.first(i)[0].date,d=_.last(i)[0].date,s=ots.core.dates.zeroDate(ots.core.dates.addDays(ots.core.dates.getDateNow(),1));ots.core.oneTime.getWeeksOfTimesheets(o,d).done(function(e){_.chain(i).zip(e).map(function(e){return{weekOfTimesheets:e[1],$dayTds:_.map(e[0],"$td")}}).each(n)})}e.bind("navigate change",i),n.bind("dataBound",i),i()}function o(t,n){function a(){t.find("table tbody tr td > a.t-action-link").each(function(){e(this).parent().addClass("public-holiday")})}t.bind("change navigate",a),n.bind("dataBound",a),a()}function d(t){var n=e("#titleContainer");n.find("#headingText").parent().contents().filter(function(){return 3===this.nodeType&&e(this).nextAll("#headingText").length}).remove(),e('<span id="ots-header">Modded with OneTime Sublime v2.4 <span>( <a href="'+t+'" target="_blank">options</a> / <a href="https://github.com/Seltzer/onetime-sublime" target="_blank">docs</a> / <a href="https://github.com/Seltzer/onetime-sublime/issues" target="_blank">support</a> )</span></span>').appendTo(n)}function s(t){var n=e("html");n.attr({"data-today-highlighting-enabled":t.enableTodayHighlighting,"data-incomplete-day-highlighting-enabled":t.enableIncompleteDayHighlighting})}function c(t,n){function a(){o(t.find(".t-content.t-state-active table"))}function i(){o(n.find(".t-grid-content table"))}function o(t){t.find("tbody tr td").each(function(){e(this).css("white-space","normal")})}ots.core.oneTime.onFavTabSelected(t,function(t){var n=e(t.item).text();(ots.core.containsSubstring(n,"personal")||ots.core.containsSubstring(n,"team"))&&a()}),n.bind("dataBound",i),a(),i()}function r(t,n,a){function i(){var t=ots.core.dates.zeroDate(ots.core.dates.getDateNow()),n=ots.core.dates.addMonths(t,-3),i=a?ots.core.dates.addMonths(t,1):t,o=ots.core.dates.getWeekStart(n),r=ots.core.dates.getWeekStart(i);return ots.core.oneTime.getWeeksOfTimesheets(o,r).pipe(function(t){if(d=_.chain(t).map(function(e){return e.days}).flatten().filter(function(e){return e.isIncomplete&&e.date>=n&&e.date<=i}).value(),c){var a=_.findIndex(d,function(e){return e.date>=c});if(-1!==a)return s=a,c=d[a].date,e.Deferred().resolve()}return s=0,c=d.length?d[s].date:null,e.Deferred().resolve()})}function o(){ots.core.oneTime.selectDayInCalendar(t,n,d[s].date,!0),s=(s+1)%d.length,c=d[s].date}var d=null,s=null,c=null;i(),e("#saveBtn, #copyTimesheetBtn span, #deleteTimesheetBtn span").click(function(){d=null}),e('<button id="find-incomplete-day" class="button">Find incomplete day</button>').insertAfter(e("#today")).click(function(){null===d?i().done(function(){d.length&&o()}):d.length&&o()})}var l="table:eq(1) > tbody > tr";e(function(){var l=e("#ots-config").data("ots-config");d(l.optionsUrl);var u=e("#cal"),f=u.data("tCalendar"),g=e("#weekgrid"),h=g.data("tGrid"),p=e("#favTab"),m=e("#timesheetgrid");s(l),f.stopAnimation=!0,l.enableFavouritesFiltering&&a(p),(l.enableIncompleteDayHighlighting||l.enableTodayHighlighting)&&(o(u,g),l.enableIncompleteDayHighlighting&&i(u,f,g,l.includeFutureDays),l.enableTodayHighlighting&&n(u,f,g)),l.enableWeekGridClicking&&t(u,f,g,h,l.allowMonthChange),l.enableTableTextWrapping&&c(p,m),l.enableFindIncompleteButton&&r(u,f,l.includeFutureDays)})}(jQuery);
