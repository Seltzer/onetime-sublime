var ots={};ots.core=function(){return{TimesheetCompleteness:{Blank:"blank",PartiallyComplete:"partially-complete",Complete:"complete",Exceeded:"exceeded"},containsSubstring:function(e,t,n){return n?-1!==e.indexOf(t):-1!==e.toLowerCase().indexOf(t.toLowerCase())},unfold:function(e,t,n){for(var o=[],r=e;n(r);)o.push(r),r=t(r);return o},computeDayCompleteness:function(e,t,n){var o=ots.core.dates.isWeekDay(e)?parseFloat(showjobsOptions.stdHours):0;return t>o?ots.core.TimesheetCompleteness.Exceeded:n||t===o?ots.core.TimesheetCompleteness.Complete:t>0?ots.core.TimesheetCompleteness.PartiallyComplete:ots.core.TimesheetCompleteness.Blank}}}(),ots.core.dates=function(){return{getDateNow:function(){return new Date},isWeekDay:function(e){return this.getNormalisedDayOfWeek(e)<5},areSameDay:function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},getNormalisedDayOfWeek:function(e){return(e.getDay()+6)%7},getWeekStart:function(e){var t=ots.core.dates.getNormalisedDayOfWeek(e);return ots.core.dates.zeroDate(ots.core.dates.addDays(e,-t))},getMonthStart:function(e){return new Date(e.getFullYear(),e.getMonth())},addMonths:function(e,t){var n=new Date(e);return n.setMonth(n.getMonth()+t),n},addDays:function(e,t){var n=new Date(e);return n.setDate(n.getDate()+t),n},zeroDate:function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}}}(),ots.core.oneTime=function(){return{calendarIsInStandardMode:function(e){return 0===e.currentView.index},onFavTabSelected:function(e,t){if(!e)throw"Must specify $favTab";e.bind("select",function(e){e.item&&t(e)})},selectDayInCalendar:function(e,t,n,o){var r=t.viewedMonth.toDate(),a=n.getMonth()-r.getMonth();if(0!==a){if(!o)return;t.navigateHorizontally(0,ots.core.dates.getMonthStart(n),a>0)}var s=ots.core.oneTime.getDayInDisplayedCalendar(e,t,n);s&&(s.$td.children("a").click(),"undefined"!=typeof HighlightCalendarWeek&&HighlightCalendarWeek(s.$td))},getWeeksInDisplayedCalendar:function(e,t){var n=t.viewedMonth.toDate(),o=e.find("table tbody tr td:first-child");return _.map(o,function(e){var t=$(e),o=t.add(t.nextAll());return _.map(o,function(e){var t=$(e),o=parseInt(t.text()),r=t.hasClass("t-other-month")&&o>15,a=!r&&t.hasClass("t-other-month")&&15>o,s=new Date(n);return r&&s.setMonth(s.getMonth()-1),a&&s.setMonth(s.getMonth()+1),s.setDate(o),{$td:t,date:s}})})},getDayInDisplayedCalendar:function(e,t,n){var o=ots.core.oneTime.getWeeksInDisplayedCalendar(e,t);return _.chain(o).flatten().find(function(e){return ots.core.dates.areSameDay(e.date,n)}).value()},getWeeksOfTimesheets:function(e,t){function n(e){var t=$.telerik.formatString("{0:MM/dd/yyyy}",e),n="/Home/_selectdate?date="+$.URLEncode(t)+"&UserName="+showjobsOptions.userName+"&viewType=View%20Month&ots";return $.post(n,{})}if(t=t||ots.core.dates.getDateNow(),e>t)throw"start must be <= end";var o=ots.core.dates.getWeekStart(e),r=ots.core.dates.getWeekStart(t),a=ots.core.unfold(o,function(e){return ots.core.dates.addDays(e,7)},function(e){return r>=e}),s=ots.core.dates.getMonthStart(o),i=ots.core.dates.getMonthStart(ots.core.dates.addDays(r,6)),c=ots.core.unfold(s,function(e){return ots.core.dates.addMonths(e,1)},function(e){return i>=e}),u=_.map(c,n);return $.when.apply($,u).pipe(function(){var e=_.chain(arguments).map(function(e){return e[0].data}).flatten().groupBy(function(e){var t=e.Date.split("/");return new Date(t[2],t[1]-1,t[0])}).value(),t=_.chain(a).map(function(t){var n=_.times(7,function(e){return ots.core.dates.addDays(t,e)}),o=_.map(n,function(t){return _.reduce(e[t]||[],function(e,t){return e+t.Duration},0)}),r=_.reduce(o,function(e,t){return e+t},0),a=r>=showjobsOptions.stdHoursPerWeek;return{week:t,isIncomplete:!a,days:_.chain(n).zip(o).map(function(e){return{date:e[0],hours:e[1],completeness:ots.core.computeDayCompleteness(e[0],e[1],a)}}).value()}}).value();return $.Deferred().resolve(t)})}}}(),ots.core.analytics=function(){function e(e){for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);t+=o>=65&&90>=o?String.fromCharCode((o-65+a)%26+65):o>=97&&122>=o?String.fromCharCode((o-97+a)%26+97):e.charAt(n)}return t.split("").reverse().join("")}var t,n,o,r=!1,a=13;return{initialise:function(){"https:"!==document.location.protocol&&(r=!0,t=$('<div id="ots-analytics"></div>').appendTo($("body")),n=(new Date).getTime(),o=e(showjobsOptions.userName),ots.core.analytics.record("load"))},record:function(e,a){if(r){a=a||{},a.ts=(new Date).getTime(),a.s=n,a.u=o,a.type=e;var s=_.chain(a).map(function(e,t){return $.URLEncode(t)+"="+$.URLEncode(e)}).reduce(function(e,t,n){return e+(0===n?"?":"&")+t},"").value(),i="http://thesoftwarecondition.com/spi.gif"+s;t.html('<img src="'+i+'"></img>')}}}}();
