var ots={};ots.core=function(){return{containsSubstring:function(e,t,n){return n?-1!==e.indexOf(t):-1!==e.toLowerCase().indexOf(t.toLowerCase())},unfold:function(e,t,n){for(var r=[],o=e;n(o);)r.push(o),o=t(o);return r}}}(),ots.core.dates=function(){return{getDateNow:function(){return new Date},isWeekDay:function(e){return this.getNormalisedDayOfWeek(e)<5},areSameDay:function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},getNormalisedDayOfWeek:function(e){return(e.getDay()+6)%7},getWeekStart:function(e){var t=ots.core.dates.getNormalisedDayOfWeek(e);return ots.core.dates.zeroDate(ots.core.dates.addDays(e,-t))},getMonthStart:function(e){return new Date(e.getFullYear(),e.getMonth())},addMonths:function(e,t){var n=new Date(e);return n.setMonth(n.getMonth()+t),n},addDays:function(e,t){var n=new Date(e);return n.setDate(n.getDate()+t),n},zeroDate:function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}}}(),ots.core.oneTime=function(){return{calendarIsInStandardMode:function(e){return 0===e.currentView.index},onFavTabSelected:function(e,t){if(!e)throw"Must specify $favTab";e.bind("select",function(e){e.item&&t(e)})},selectDayInCalendar:function(e,t,n,r){var o=t.viewedMonth.toDate(),a=n.getMonth()-o.getMonth();if(0!==a){if(!r)return;t.navigateHorizontally(0,ots.core.dates.getMonthStart(n),a>0)}var s=ots.core.oneTime.getDayInDisplayedCalendar(e,t,n);s&&(s.$td.children("a").click(),"undefined"!=typeof HighlightCalendarWeek&&HighlightCalendarWeek(s.$td))},getWeeksInDisplayedCalendar:function(e,t){var n=t.viewedMonth.toDate(),r=e.find("table tbody tr td:first-child");return _.map(r,function(e){var t=$(e),r=t.add(t.nextAll());return _.map(r,function(e){var t=$(e),r=parseInt(t.text()),o=t.hasClass("t-other-month")&&r>15,a=!o&&t.hasClass("t-other-month")&&15>r,s=new Date(n);return o&&s.setMonth(s.getMonth()-1),a&&s.setMonth(s.getMonth()+1),s.setDate(r),{$td:t,date:s}})})},getDayInDisplayedCalendar:function(e,t,n){var r=ots.core.oneTime.getWeeksInDisplayedCalendar(e,t);return _.chain(r).flatten().find(function(e){return ots.core.dates.areSameDay(e.date,n)}).value()},getWeeksOfTimesheets:function(e,t){function n(e){var t=$.telerik.formatString("{0:MM/dd/yyyy}",e),n="/Home/_selectdate?date="+$.URLEncode(t)+"&UserName="+showjobsOptions.userName+"&viewType=View%20Month&ots";return $.post(n,{})}if(t=t||ots.core.dates.getDateNow(),e>t)throw"start must be <= end";var r=ots.core.dates.getWeekStart(e),o=ots.core.dates.getWeekStart(t),a=ots.core.unfold(r,function(e){return ots.core.dates.addDays(e,7)},function(e){return o>=e}),s=ots.core.dates.getMonthStart(r),i=ots.core.dates.getMonthStart(ots.core.dates.addDays(o,6)),u=ots.core.unfold(s,function(e){return ots.core.dates.addMonths(e,1)},function(e){return i>=e}),c=_.map(u,n);return $.when.apply($,c).pipe(function(){var e=_.chain(arguments).map(function(e){return e[0].data}).flatten().groupBy(function(e){var t=e.Date.split("/");return new Date(t[2],t[1]-1,t[0])}).value(),t=_.chain(a).map(function(t){var n=_.times(7,function(e){return ots.core.dates.addDays(t,e)}),r=_.map(n,function(t){return _.reduce(e[t]||[],function(e,t){return e+t.Duration},0)}),o=_.reduce(r,function(e,t){return e+t},0),a=o>=showjobsOptions.stdHoursPerWeek;return{week:t,isIncomplete:!a,days:_.chain(n).zip(r).map(function(e){return{date:e[0],hours:e[1],isIncomplete:!a&&ots.core.dates.isWeekDay(e[0])&&e[1]<showjobsOptions.stdHours}}).value()}}).value();return $.Deferred().resolve(t)})}}}(),ots.core.analytics=function(){function e(e){for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);t+=r>=65&&90>=r?String.fromCharCode((r-65+a)%26+65):r>=97&&122>=r?String.fromCharCode((r-97+a)%26+97):e.charAt(n)}return t.split("").reverse().join("")}var t,n,r,o=!1,a=13;return{initialise:function(){"https:"!==document.location.protocol&&(o=!0,t=$('<div id="ots-analytics"></div>').appendTo($("body")),n=(new Date).getTime(),r=e(showjobsOptions.userName),ots.core.analytics.record("load"))},record:function(e,a){if(o){a=a||{},a.ts=(new Date).getTime(),a.s=n,a.u=r,a.type=e;var s=_.chain(a).map(function(e,t){return $.URLEncode(t)+"="+$.URLEncode(e)}).reduce(function(e,t,n){return e+(0===n?"?":"&")+t},"").value(),i="http://thesoftwarecondition.com/spi.gif"+s;t.html('<img src="'+i+'"></img>')}}}}();
