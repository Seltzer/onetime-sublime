var ots={};ots.core=function(){return{containsSubstring:function(e,t,n){return n?-1!==e.indexOf(t):-1!==e.toLowerCase().indexOf(t.toLowerCase())},unfold:function(e,t,n){for(var r=[],a=e;n(a);)r.push(a),a=t(a);return r}}}(),ots.core.dates=function(){return{getDateNow:function(){return new Date},isWeekDay:function(e){return this.getNormalisedDayOfWeek(e)<5},areSameDay:function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},getNormalisedDayOfWeek:function(e){return(e.getDay()+6)%7},getWeekStart:function(e){var t=ots.core.dates.getNormalisedDayOfWeek(e);return ots.core.dates.zeroDate(ots.core.dates.addDays(e,-t))},getMonthStart:function(e){return new Date(e.getFullYear(),e.getMonth())},addMonths:function(e,t){var n=new Date(e);return n.setMonth(n.getMonth()+t),n},addDays:function(e,t){var n=new Date(e);return n.setDate(n.getDate()+t),n},zeroDate:function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}}}(),ots.core.oneTime=function(){return{onFavTabSelected:function(e,t){if(!e)throw"Must specify $favTab";e.bind("select",function(e){e.item&&t(e)})},selectDayInCalendar:function(e,t,n,r){var a=t.viewedMonth.toDate(),o=n.getMonth()-a.getMonth();if(0!==o){if(!r)return;t.navigateHorizontally(0,ots.core.dates.getMonthStart(n),o>0)}var s=ots.core.oneTime.getDayInDisplayedCalendar(e,t,n);s&&(s.$td.children("a").click(),"undefined"!=typeof HighlightCalendarWeek&&HighlightCalendarWeek(s.$td))},getWeeksInDisplayedCalendar:function(e,t){var n=t.viewedMonth.toDate(),r=e.find("table tbody tr td:first-child");return _.map(r,function(e){var t=$(e),r=t.add(t.nextAll());return _.map(r,function(e){var t=$(e),r=parseInt(t.text()),a=t.hasClass("t-other-month")&&r>15,o=!a&&t.hasClass("t-other-month")&&15>r,s=new Date(n);return a&&s.setMonth(s.getMonth()-1),o&&s.setMonth(s.getMonth()+1),s.setDate(r),{$td:t,date:s}})})},getDayInDisplayedCalendar:function(e,t,n){var r=ots.core.oneTime.getWeeksInDisplayedCalendar(e,t);return _.chain(r).flatten().find(function(e){return ots.core.dates.areSameDay(e.date,n)}).value()},getWeeksOfTimesheets:function(e,t){function n(e){var t=$.telerik.formatString("{0:MM/dd/yyyy}",e),n="/Home/_selectdate?date="+$.URLEncode(t)+"&UserName="+showjobsOptions.userName+"&viewType=View%20Month";return $.post(n,{})}if(t=t||ots.core.dates.getDateNow(),e>t)throw"start must be <= end";var r=ots.core.dates.getWeekStart(e),a=ots.core.dates.getWeekStart(t),o=ots.core.unfold(r,function(e){return ots.core.dates.addDays(e,7)},function(e){return a>=e}),s=ots.core.dates.getMonthStart(r),u=ots.core.dates.getMonthStart(ots.core.dates.addDays(a,6)),i=ots.core.unfold(s,function(e){return ots.core.dates.addMonths(e,1)},function(e){return u>=e}),d=_.map(i,n);return $.when.apply($,d).pipe(function(){var e=_.chain(arguments).map(function(e){return e[0].data}).flatten().groupBy(function(e){var t=e.Date.split("/");return new Date(t[2],t[1]-1,t[0])}).value(),t=_.chain(o).map(function(t){var n=_.times(7,function(e){return ots.core.dates.addDays(t,e)}),r=_.map(n,function(t){return _.reduce(e[t]||[],function(e,t){return e+t.Duration},0)}),a=_.reduce(r,function(e,t){return e+t},0),o=a>=showjobsOptions.stdHoursPerWeek;return{week:t,isIncomplete:!o,days:_.chain(n).zip(r).map(function(e){return{date:e[0],isIncomplete:!o&&ots.core.dates.isWeekDay(e[0])&&e[1]<showjobsOptions.stdHours}}).value()}}).value();return $.Deferred().resolve(t)})}}}();
